# Arhivach Downloader

Модуль загрузки тредов с сайта Архивач (https://arhivach.vc/).

## Возможности

- Интерактивный интерфейс с меню
- Загрузка отдельного треда по прямой ссылке
- Загрузка всех тредов по тегу с поддержкой пагинации
- Выбор порядка загрузки по тегу (от старых к новым / от новых к старым)
- Мониторинг тредов и тегов (до 20 элементов)
- Асинхронная загрузка медиа-файлов (до 30 одновременно)
- Конвертация изображений в JPG для экономии места (PNG, WebP, BMP -> JPG)
- Прогресс-бары и статистика загрузки
- Автоматическая проверка и установка зависимостей
- Управление версиями библиотек

## Установка

```bash
pip install -r requirements.txt
```

Или просто запустите скрипт - он автоматически проверит и предложит установить недостающие зависимости:

```bash
python main.py
```

## Использование

### Интерактивный режим (рекомендуется)

```bash
python main.py
```

### Режим командной строки

```bash
# Загрузка отдельного треда
python main.py --thread https://arhivach.vc/thread/1122323/

# Загрузка тредов по тегу
python main.py --tag 14905
python main.py --tag https://arhivach.vc/?tags=14905

# С ограничением страниц
python main.py --tag 14905 --max-pages 5

# С дополнительными параметрами
python main.py --tag 14905 --output ./downloads --concurrent 10
```

## Параметры командной строки

| Параметр | Описание |
|----------|----------|
| `--thread, -t` | URL отдельного треда |
| `--tag, -g` | ID тега или URL страницы тега |
| `--output, -o` | Директория для сохранения (по умолчанию: `downloads`) |
| `--max-pages, -p` | Макс. количество страниц для обработки |
| `--domain, -d` | Домен Архивача |
| `--concurrent, -c` | Количество одновременных загрузок (1-30, по умолчанию: 5) |
| `--help-args` | Показать справку по аргументам |

## Структура сохранённых данных

Папки тредов называются по дате создания ОП-поста: `ДД.ММ.ГГ_ID`

```
downloads/
+-- tag_14905/                    # Папка тега
|   +-- 20.01.25_1122323/         # Папка треда (дата_ID)
|   |   +-- thread.html           # HTML страницы
|   |   +-- media/                # Медиа-файлы (изображения, видео)
|   |   +-- resources/            # CSS и JS файлы
|   +-- 19.01.25_1121711/
|       +-- thread.html
|       +-- media/
|       +-- resources/
+-- 20.01.25_1277766/             # Отдельный тред
    +-- thread.html
    +-- media/
    +-- resources/
```

HTML файл автоматически ссылается на локальные версии:
- Изображения: `media/filename.jpg`
- Стили/скрипты: `resources/style.css`

## Мониторинг

Функция мониторинга позволяет отслеживать обновления в тредах и тегах:

- Добавьте до 20 тредов или тегов в список мониторинга
- Запустите проверку обновлений из меню
- Скрипт докачает новые посты и медиа-файлы

## Настройки

В интерактивном меню (пункт "Настройки"):
- Домен Архивача
- Папка загрузок
- Количество одновременных загрузок (1-30)
- Таймаут запросов
- Задержка между страницами
- Конвертация изображений в JPG (вкл/выкл, качество 1-100%)

Или в файле `config.py`:
- `ARHIVACH_DOMAIN` - домен Архивача
- `OUTPUT_DIR` - папка для загрузок
- `MAX_CONCURRENT_DOWNLOADS` - макс. одновременных загрузок
- `REQUEST_TIMEOUT` - таймаут запросов
- `PAGE_REQUEST_DELAY` - задержка между запросами страниц
- `CONVERT_IMAGES_TO_JPG` - конвертировать PNG/WebP/BMP в JPG (по умолчанию: True)
- `JPG_QUALITY` - качество JPG при конвертации (по умолчанию: 85)

---

### Настройки (в начале файла `find_faces.py`)

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `source_dir` | Папка для сканирования | `downloads` |
| `output_dir` | Папка для результатов | `faces_found` |
| `detection_model` | `hog` (CPU, быстро) или `cnn` (GPU, точно) | `hog` |
| `min_face_size` | Мин. размер лица в пикселях | `40` |
| `num_workers` | Количество потоков обработки | `4` |
| `preserve_structure` | Сохранять структуру папок | `True` |
| `skip_processed` | Пропускать уже обработанные | `True` |
| `upsample_times` | Увеличение для мелких лиц (0/1/2) | `1` |

### Особенности

- Интерактивный выбор настроек при запуске
- Лог обработанных файлов — можно прервать и продолжить
- Прогресс с оценкой оставшегося времени
- Библиотека `face_recognition` хорошо детектирует реальные лица и плохо — аниме
